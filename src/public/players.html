<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Players Management - Live Scoreboard</title>
        <link rel="stylesheet" href="/css/admin.css" />
        <style>
            .players-container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
            }

            .players-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
            }

            .players-table {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            }

            .table {
                width: 100%;
                border-collapse: collapse;
            }

            .table th,
            .table td {
                padding: 15px 20px;
                text-align: left;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                color: #ecf0f1;
            }

            .table th {
                background: rgba(52, 152, 219, 0.2);
                font-weight: 600;
                color: #3498db;
                text-transform: uppercase;
                font-size: 0.85em;
                letter-spacing: 0.5px;
            }

            .table tr:hover {
                background: rgba(255, 255, 255, 0.05);
            }

            .table tr:last-child td {
                border-bottom: none;
            }

            .player-actions {
                display: flex;
                gap: 8px;
            }

            .btn-small {
                padding: 4px 8px;
                font-size: 12px;
            }

            .search-box {
                margin-bottom: 20px;
            }

            .search-box input {
                width: 100%;
                padding: 12px 15px;
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 8px;
                font-size: 14px;
                background: rgba(255, 255, 255, 0.1);
                color: #ecf0f1;
                outline: none;
            }

            .search-box input:focus {
                border-color: #3498db;
                box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
            }

            .search-box input::placeholder {
                color: #95a5a6;
            }

            .no-players {
                text-align: center;
                padding: 40px;
                color: #bdc3c7;
                font-style: italic;
            }

            .stats-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .stat-card {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                padding: 25px;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
                text-align: center;
            }

            .stat-number {
                font-size: 28px;
                font-weight: bold;
                color: #3498db;
            }

            .stat-label {
                color: #bdc3c7;
                margin-top: 8px;
                font-weight: 500;
            }
        </style>
    </head>
    <body>
        <div id="players-app">
            <!-- Login Form -->
            <div v-if="!isLoggedIn" class="login-container">
                <div class="login-form">
                    <h2>Admin Login</h2>
                    <form @submit.prevent="login">
                        <div class="form-group">
                            <label for="username">Username:</label>
                            <input
                                type="text"
                                id="username"
                                v-model="loginForm.username"
                                required
                                placeholder="Enter username"
                            />
                        </div>
                        <div class="form-group">
                            <label for="password">Password:</label>
                            <input
                                type="password"
                                id="password"
                                v-model="loginForm.password"
                                required
                                placeholder="Enter password"
                            />
                        </div>
                        <button
                            type="submit"
                            class="btn btn-primary"
                            :disabled="isLoading"
                        >
                            {{ isLoading ? 'Logging in...' : 'Login' }}
                        </button>
                    </form>
                    <div v-if="loginError" class="error-message">
                        {{ loginError }}
                    </div>
                    <div class="login-info">
                        <p><strong>Default credentials:</strong></p>
                        <p>Username: *****</p>
                        <p>Password: *****</p>
                    </div>
                    <a href="/admin.html" class="back-link"
                        >← Back to Admin Panel</a
                    >
                </div>
            </div>

            <!-- Players Management -->
            <div v-else class="players-container">
                <nav class="navbar">
                    <div class="nav-brand">
                        <h1>Live Scoreboard Admin</h1>
                    </div>
                    <div class="nav-menu">
                        <a href="/admin.html" class="nav-link">Competitions</a>
                        <a href="/players.html" class="nav-link active"
                            >Players</a
                        >
                        <a href="/" class="nav-link">Scoreboard</a>
                        <button
                            @click="showCreatePlayer"
                            class="btn btn-primary"
                        >
                            + New Player
                        </button>
                        <button @click="logout" class="btn btn-secondary">
                            Logout
                        </button>
                    </div>
                </nav>

                <!-- Statistics Cards -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-number">{{ totalPlayers }}</div>
                        <div class="stat-label">Total Players</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">{{ activeCompetitions }}</div>
                        <div class="stat-label">Active Competitions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">
                            {{ averagePlayersPerCompetition }}
                        </div>
                        <div class="stat-label">Avg Players/Competition</div>
                    </div>
                </div>

                <!-- Search Box -->
                <div class="search-box">
                    <input
                        type="text"
                        v-model="searchQuery"
                        placeholder="Search players by name..."
                        @input="filterPlayers"
                    />
                </div>

                <!-- Players Table -->
                <div class="players-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Created At</th>
                                <th>Competitions</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr
                                v-for="player in filteredPlayers"
                                :key="player.id"
                            >
                                <td>{{ player.id }}</td>
                                <td>{{ player.name }}</td>
                                <td>{{ formatDate(player.created_at) }}</td>
                                <td>
                                    <span class="badge"
                                        >{{ getPlayerCompetitionCount(player.id)
                                        }}</span
                                    >
                                </td>
                                <td>
                                    <div class="player-actions">
                                        <button
                                            @click="showEditPlayer(player)"
                                            class="btn btn-small btn-primary"
                                        >
                                            Edit
                                        </button>
                                        <button
                                            @click="confirmDeletePlayer(player)"
                                            class="btn btn-small btn-danger"
                                        >
                                            Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div v-if="filteredPlayers.length === 0" class="no-players">
                        <p v-if="searchQuery">
                            No players found matching "{{ searchQuery }}"
                        </p>
                        <p v-else>
                            No players found. Create your first player!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Create Player Modal -->
            <div
                v-if="showCreateModal"
                class="modal-overlay"
                @click="closeCreateModal"
            >
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3>Create New Player</h3>
                        <button @click="closeCreateModal" class="modal-close">
                            ×
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="create-player-name">Player Name:</label>
                            <input
                                id="create-player-name"
                                type="text"
                                v-model="creatingPlayer.name"
                                placeholder="Enter player name"
                                ref="createPlayerInput"
                            />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                            @click="closeCreateModal"
                            class="btn btn-secondary"
                        >
                            Cancel
                        </button>
                        <button
                            @click="createPlayer"
                            class="btn btn-primary"
                            :disabled="!creatingPlayer.name.trim()"
                        >
                            Create Player
                        </button>
                    </div>
                </div>
            </div>

            <!-- Edit Player Modal -->
            <div
                v-if="showEditModal"
                class="modal-overlay"
                @click="closeEditModal"
            >
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3>Edit Player</h3>
                        <button @click="closeEditModal" class="modal-close">
                            ×
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="edit-player-name">Player Name:</label>
                            <input
                                id="edit-player-name"
                                type="text"
                                v-model="editingPlayer.name"
                                placeholder="Enter player name"
                            />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                            @click="closeEditModal"
                            class="btn btn-secondary"
                        >
                            Cancel
                        </button>
                        <button
                            @click="updatePlayer"
                            class="btn btn-primary"
                            :disabled="!editingPlayer.name.trim()"
                        >
                            Update Player
                        </button>
                    </div>
                </div>
            </div>

            <!-- Delete Confirmation Modal -->
            <div
                v-if="showDeleteModal"
                class="modal-overlay"
                @click="closeDeleteModal"
            >
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3>Confirm Delete</h3>
                        <button @click="closeDeleteModal" class="modal-close">
                            ×
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Are you sure you want to delete the player "<strong
                                >{{ deletingPlayer.name }}</strong
                            >"?
                        </p>
                        <p class="warning">
                            This will also remove the player from all
                            competitions and cannot be undone.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button
                            @click="closeDeleteModal"
                            class="btn btn-secondary"
                        >
                            Cancel
                        </button>
                        <button @click="deletePlayer" class="btn btn-danger">
                            Delete Player
                        </button>
                    </div>
                </div>
            </div>

            <!-- Message Toast -->
            <div v-if="message" :class="['message-toast', messageType]">
                {{ message }}
            </div>
        </div>

        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <script src="/js/players.js"></script>
    </body>
</html>
